extends ../../layouts/default.pug
include ../../mixins/box-head.pug
include ../../mixins/product-layout.pug
include ../../mixins/sub-menu.pug
include ../../mixins/pagination.pug
block main 
    +alert-error(5000)
    +alert-success(5000)
    .shop.sp_top_30
        .container
            .row.grid__responsive
                .col-xl-3.col-lg-3.col-md-4.col-sm-12.col-12
                    button.default__button.sidebar-collapse-btn(type="button", data-aos="fade-up", data-aos-duration="1800")
                        svg(xmlns="http://www.w3.org/2000/svg", height="24", viewBox="0 0 32 32", width="24")
                            g#Layer_2(data-name="Layer 2")
                                path(d="m28.552 6.184h-2.671a4.556 4.556 0 0 0 -8.659 0h-13.774a1.449 1.449 0 0 0 0 2.9h13.774a4.556 4.556 0 0 0 8.659 0h2.671a1.449 1.449 0 0 0 0-2.9zm-7 3.138a1.69 1.69 0 1 1 1.689-1.69 1.692 1.692 0 0 1 -1.689 1.69z")
                                path(d="m28.552 14.552h-13.774a4.556 4.556 0 0 0 -8.659 0h-2.671a1.448 1.448 0 0 0 0 2.9h2.671a4.556 4.556 0 0 0 8.659 0h13.774a1.448 1.448 0 0 0 0-2.9zm-18.1 3.138a1.69 1.69 0 1 1 1.686-1.69 1.692 1.692 0 0 1 -1.69 1.69z")
                                path(d="m28.552 22.919h-2.671a4.556 4.556 0 0 0 -8.659 0h-13.774a1.449 1.449 0 0 0 0 2.9h13.774a4.556 4.556 0 0 0 8.659 0h2.671a1.449 1.449 0 0 0 0-2.9zm-7 3.138a1.69 1.69 0 1 1 1.689-1.689 1.692 1.692 0 0 1 -1.689 1.689z")
                    .sidebar.sidebar-collapse-hide
                        .sidebar__widget.widget-collapse-show
                            .sidebar__title
                                h4 Danh mục
                                i.fa.fa-angle-down
                            .sidebar__menu
                                ul
                                    +sub_category(layoutProductsCategory)
                        .sidebar__widget.widget-collapse-show
                            .sidebar__title
                                h4 Giá
                                i.fa.fa-angle-down
                            .sidebar__menu
                                ul
                                    li
                                        .sidebar__box
                                            input#price1(type="radio" name="price" value="under-100k")
                                            label(for="price1") Dưới 100.000 VND

                                    li
                                        .sidebar__box
                                            input#price2(type="radio" name="price" value="100k-200k")
                                            label(for="price2") 100.000 - 200.000 VND

                                    li
                                        .sidebar__box
                                            input#price3(type="radio" name="price" value="200k-500k")
                                            label(for="price3") 200.000 - 500.000 VND

                                    li
                                        .sidebar__box
                                            input#price4(type="radio" name="price" value="500k-1m")
                                            label(for="price4") 500.000 - 1.000.000 VND

                                    li
                                        .sidebar__box
                                            input#price5(type="radio" name="price" value="above-1m")
                                            label(for="price5") Trên 1.000.000 VND
                .col-xl-9.col-lg-9.col-md-8.col-sm-12.col-12
                    .shop__right__wraper
                        .shop__tab
                            ul.nav#myTab(role="tablist")
                                li.nav-item(role="presentation")
                                    button.shop__tap__link.active(type="button", data-bs-toggle="tab", data-bs-target="#projects__one")
                                        i.fas.fa-th-large
                                //- li.nav-item(role="presentation")
                                //-     button.shop__tap__link(type="button", data-bs-toggle="tab", data-bs-target="#projects__two")
                                //-         i.fas.fa-list
                        .shop__selecte
                            select.nice-select(
                                name="SortBy" 
                                id="SortBy"
                                sort-select
                            )
                                //- option(value="manual") Featured
                                option(value="created-descending") Mới đến cũ
                                option(value="created-ascending") Cũ đến mới
                                option(value="price-desc") Giá giảm dần
                                option(value="price-asc") Giá tăng dần
                                option(value="title-asc") Tiêu đề A-Z 
                                option(value="title-desc") Tiêu đề Z-A
                                
                            
                        .shop__number.text-right
                            button(class="btn btn-danger"
                                sort-clear
                            ) Clear
                    .tab-content#myTabContent
                        .tab-pane.fade.active.show#projects__one(role="tabpanel", aria-labelledby="projects__one")
                            .row.grid__responsive
                                each item in products
                                    .col-xl-4.col-lg-4.col-md-6.col-sm-6.col-6
                                        .grid__wraper
                                            .grid__wraper__img
                                                .grid__wraper__img__inner
                                                    a(href=`/products/detail/${item.slug}`)
                                                        img.primary__image(src=item.thumbnail[0] alt=item.title height="300px" weigh="300px")
                                                        //- img.secondary__image(src="img/grid/grid__2.png" alt="Secondary Image")
                                                .grid__wraper__icon
                                                    ul
                                                        li
                                                            span(data-bs-toggle="modal" data-bs-target=`#${item.id}`)
                                                                a.quick__view__action(href=`#` data-bs-toggle="tooltip" data-bs-placement="top" title="Thêm vào giỏ hàng" data-bs-original-title="Quick View")
                                                                    i.fas.fa-shopping-cart
                                                        li
                                                            a(href=`/products/detail/${item.slug}` data-bs-toggle="tooltip" data-bs-placement="top" title="Xem chi tiết" data-bs-original-title="Add To Cart")
                                                                i.far.fa-eye
                                                        li
                                                            a(href=`/wishlists/toggle/${item.id}` data-bs-toggle="tooltip" data-bs-placement="top" title="Thêm vào danh sách yêu thích" data-bs-original-title="Add To Wishlist")
                                                                if productIdsInWishlist.includes(item._id.toString())
                                                                    i.fas.fa-heart
                                                                else
                                                                    i.far.fa-heart
                                                        
                                                .grid__wraper__badge
                                                
                                                    if(item.discountPercentage)
                                                        span.sale__badge -#{item.discountPercentage}%
                                            .grid__wraper__info
                                                h3.grid__wraper__tittle
                                                    a(href=`/products/detail/${item.slug}` tabindex="0") #{item.title}
                                                .grid__wraper__price
                                                    if item.variants && item.variants.length > 0
                                                        if(item.discountPercentage)
                                                            del #{item.variants[0].price} 
                                                            - var discountAmount = item.variants[0].price * (item.discountPercentage / 100)
                                                                span #{(item.variants[0].price - discountAmount).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}
                                                        else 
                                                            span #{item.variants[0].price.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })} 
                
                +pagination(pagination)
    script. 
        document.addEventListener('DOMContentLoaded', function() {
            const sortSelect = document.querySelector('#SortBy')
            const sortClear=document.querySelector("[sort-clear]")
            const priceRadios = document.querySelectorAll('.sidebar__box input[type="radio"]');
            sortClear.addEventListener("click",()=>{
                    url.searchParams.delete("sortKey")
                    url.searchParams.delete("sortValue")
                    window.location.href=url.href
            })
            sortSelect.addEventListener('change', function(e) {
                const value = e.target.value;
                const [sortKey, sortValue] = value.split('-');
                const url = new URL(window.location.href);
                url.searchParams.set('sortKey', sortKey);
                url.searchParams.set('sortValue', sortValue);
                window.location.href = url.href;
            });

           
            const url = new URL(window.location.href);
            const sortKey = url.searchParams.get('sortKey');
            const sortValue = url.searchParams.get('sortValue');

            if (sortKey && sortValue) {
                const sortValueString = `${sortKey}-${sortValue}`;
                const option = sortSelect.querySelector(`option[value='${sortValueString}']`);
                if (option) {
                    option.selected = true;
                }
            }
            priceRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const selectedPrice = radio.value; // Lấy giá trị radio được chọn
                    const url = new URL(window.location.href);
                    url.searchParams.set('price', selectedPrice); // Thêm tham số giá vào URL
                    window.location.href = url.href; // Tải lại trang với tham số giá
                });
            });
            const selectedPrice = url.searchParams.get('price');
            if (selectedPrice) {
                const selectedRadio = document.querySelector(`input[type="radio"][value="${selectedPrice}"]`);
                if (selectedRadio) {
                    selectedRadio.checked = true; 
                }
            }

        });
        
    



        
                



